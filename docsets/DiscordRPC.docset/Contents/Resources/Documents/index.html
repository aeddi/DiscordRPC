<!DOCTYPE html>
<html lang="en">
  <head>
    <title>DiscordRPC  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    <link rel="icon" type="image/png" sizes="96x96" href="https://aeddi.github.io/DiscordRPC/img/favicon/96x96.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://aeddi.github.io/DiscordRPC/img/favicon/32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://aeddi.github.io/DiscordRPC/img/favicon/16x16.png">

    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>
    <a title="DiscordRPC  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html">DiscordRPC 1.0.0 Docs</a> (5% documented)</p>
        <p class="header-right"><a href="https://github.com/aeddi/DiscordRPC"><img src="img/gh.png"/>View on GitHub</a></p>
        <p class="header-right"><a href="dash-feed://https%3A%2F%2Faeddi.github.io%2FDiscordRPC%2Fdocsets%2FDiscordRPC.xml"><img src="img/dash.png"/>Install in Dash</a></p>
        <p class="header-right">
          <form role="search" action="search.json">
            <input type="text" placeholder="Search documentation" data-typeahead>
          </form>
        </p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html">DiscordRPC Reference</a>
        <img id="carat" src="img/carat.png" />
        DiscordRPC  Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Main%20Class.html">Main Class</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/DiscordRPC.html">DiscordRPC</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Events.html">Events</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/EventClose.html">EventClose</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/EventError.html">EventError</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/EventReady.html">EventReady</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/EventVoiceChannelSelect.html">EventVoiceChannelSelect</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Responses.html">Responses</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/ResponseAuthenticate.html">ResponseAuthenticate</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/ResponseAuthorize.html">ResponseAuthorize</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/ResponseGetGuilds.html">ResponseGetGuilds</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/ResponseSubscribe.html">ResponseSubscribe</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/ResponseUnsubscribe.html">ResponseUnsubscribe</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Types.html">Types</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/AccessToken.html">AccessToken</a>
              </li>
              <li class="nav-group-task">
                <a href="Types.html#/s:10DiscordRPC7ChannelC">Channel</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Config.html">Config</a>
              </li>
              <li class="nav-group-task">
                <a href="Types.html#/s:10DiscordRPC5EmojiC">Emoji</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Guild.html">Guild</a>
              </li>
              <li class="nav-group-task">
                <a href="Types.html#/s:10DiscordRPC12GuildFeatureC">GuildFeature</a>
              </li>
              <li class="nav-group-task">
                <a href="Types.html#/s:10DiscordRPC11GuildMemberC">GuildMember</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/OAuth2Application.html">OAuth2Application</a>
              </li>
              <li class="nav-group-task">
                <a href="Types.html#/s:10DiscordRPC8PresenceC">Presence</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/RPCToken.html">RPCToken</a>
              </li>
              <li class="nav-group-task">
                <a href="Types.html#/s:10DiscordRPC4RoleC">Role</a>
              </li>
              <li class="nav-group-task">
                <a href="Types.html#/s:10DiscordRPC13StageInstanceC">StageInstance</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/User.html">User</a>
              </li>
              <li class="nav-group-task">
                <a href="Types.html#/s:10DiscordRPC10VoiceStateC">VoiceState</a>
              </li>
              <li class="nav-group-task">
                <a href="Types.html#/s:10DiscordRPC13WelcomeScreenC">WelcomeScreen</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Enumerations.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Enums/CloseEventCode.html">CloseEventCode</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/CommandType.html">CommandType</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/ErrorCode.html">ErrorCode</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/EventType.html">EventType</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/OAuth2Scope.html">OAuth2Scope</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/PremiumType.html">PremiumType</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/UserFlag.html">UserFlag</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Errors.html">Errors</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Enums/CommandError.html">CommandError</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/HTTPError.html">HTTPError</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/NonceError.html">NonceError</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/RPCError.html">RPCError</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/RequestError.html">RequestError</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Helpers.html">Helpers</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Helpers.html#/s:10DiscordRPC19fetchUserAvatarData2id6avatar7timeout10Foundation0F0VSS_SSSiSgtKF">fetchUserAvatarData(id:avatar:timeout:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Helpers.html#/s:10DiscordRPC20fetchUserAvatarImage2id6avatar7timeoutSo7NSImageCSS_SSSiSgtKF">fetchUserAvatarImage(id:avatar:timeout:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Helpers.html#/s:10DiscordRPC14newJSONDecoder10Foundation0D0CyF">newJSONDecoder()</a>
              </li>
              <li class="nav-group-task">
                <a href="Helpers.html#/s:10DiscordRPC14newJSONEncoder10Foundation0D0CyF">newJSONEncoder()</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Extensions.html">Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Extensions/DateFormatter.html">DateFormatter</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Other%20Classes.html">Other Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/EventErrorData.html">EventErrorData</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/EventReadyData.html">EventReadyData</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/EventVoiceChannelSelectData.html">EventVoiceChannelSelectData</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Frame.html">Frame</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/ResponseAuthenticateData.html">ResponseAuthenticateData</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/ResponseAuthorizeData.html">ResponseAuthorizeData</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/ResponseGetGuildsData.html">ResponseGetGuildsData</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/ResponseSubscribeData.html">ResponseSubscribeData</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            
            <h1 id='discordrpc' class='heading'>DiscordRPC</h1>

<p><a href="https://github.com/aeddi/DiscordRPC/actions/workflows/release.yml"><img src="https://img.shields.io/github/workflow/status/aeddi/DiscordRPC/Release" alt="Build"></a>
<a href="https://github.com/aeddi/DiscordRPC/releases"><img src="https://img.shields.io/github/v/release/aeddi/DiscordRPC?color=success" alt="Release"></a>
<a href="#Requirements"><img src="https://img.shields.io/badge/platform-macOS%2011-orange" alt="Platform"></a>
<a href="#Requirements"><img src="https://img.shields.io/badge/language-Swift%205-orange" alt="Language"></a>
<a href="https://aeddi.github.io/DiscordRPC"><img src="https://img.shields.io/badge/documentation-Jazzy-blueviolet" alt="Documentation"></a>
<a href="https://github.com/aeddi/DiscordRPC/blob/master/LICENSE"><img src="https://img.shields.io/github/license/aeddi/DiscordRPC?color=blue" alt="License"></a></p>

<p>A Discord RPC library for Swift on macOS.  </p>

<p>All commands and payloads are wrapped in Swift methods and types.  </p>

<p><strong>Note</strong>: Works only with IPC for now because the Discord Websocket RPC API seems
to be disabled. See <a href="https://github.com/discord/discord-rpc/issues/342">this issue</a>.</p>
<h2 id='requirements' class='heading'>Requirements</h2>

<ul>
<li>macOS &gt;= 11 (Big Sur)</li>
<li>Swift 5</li>
<li>No <a href="https://developer.apple.com/documentation/security/app_sandbox">App Sandbox</a>
as this library needs to access to Discord
<a href="https://en.wikipedia.org/wiki/Unix_domain_socket">UDS</a> file</li>
</ul>
<h2 id='usage' class='heading'>Usage</h2>
<h3 id='installation' class='heading'>Installation</h3>

<p>DiscordRPC library is available as a <a href="https://developer.apple.com/documentation/swift_packages">Swift Package Manager</a>
package.  </p>

<p>You can use it as a dependency of your own package by adding this in its <code>Package.swift</code>:</p>
<pre class="highlight swift"><code><span class="nv">dependencies</span><span class="p">:</span> <span class="p">[</span>
    <span class="o">.</span><span class="kt">Package</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="s">"https://github.com/aeddi/DiscordRPC.git"</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="s">"1.0.0"</span><span class="p">)</span>
<span class="p">]</span>
</code></pre>

<p>Or you can add it to your XCode project by following <a href="https://developer.apple.com/documentation/swift_packages/adding_package_dependencies_to_your_app">this tutorial</a>.</p>
<h3 id='code-example' class='heading'>Code Example</h3>

<p>You will first need to create an application on the <a href="https://discord.com/developers/applications">Discord Developer Dashboard</a>
and then to retrieve the Client ID (and optionally the Client Secret depending
on your use case) in the OAuth2 section.</p>
<h4 id='complete-demo' class='heading'>Complete demo</h4>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">DiscordRPC</span>
<span class="kd">import</span> <span class="kt">Dispatch</span>

<span class="c1">// Instantiate DiscordRPC using client ID and Secret</span>
<span class="k">let</span> <span class="nv">discordRPC</span> <span class="o">=</span> <span class="kt">DiscordRPC</span><span class="p">(</span><span class="nv">clientID</span><span class="p">:</span> <span class="s">"XXXXXX"</span><span class="p">,</span> <span class="nv">clientSecret</span><span class="p">:</span> <span class="s">"YYYYYY"</span><span class="p">)</span>

<span class="c1">// This handler is called as soon as the Discord RPC handshake succeeded</span>
<span class="n">discordRPC</span><span class="o">.</span><span class="n">onConnect</span> <span class="p">{</span> <span class="n">rpc</span><span class="p">,</span> <span class="n">eventReady</span> <span class="k">in</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Connection to Discord RPC API succeeded"</span><span class="p">)</span>

    <span class="k">do</span> <span class="p">{</span>
        <span class="c1">// Ask user authorization by displaying a popup on the Discord client</span>
        <span class="k">let</span> <span class="nv">authorization</span> <span class="o">=</span> <span class="k">try</span> <span class="n">rpc</span><span class="o">.</span><span class="nf">authorize</span><span class="p">(</span><span class="nv">oAuth2Scopes</span><span class="p">:</span> <span class="p">[</span><span class="o">.</span><span class="n">rpc</span><span class="p">])</span>

        <span class="c1">// Request an access token on Discord servers using the authorization code</span>
        <span class="k">let</span> <span class="nv">accessToken</span> <span class="o">=</span> <span class="k">try</span> <span class="n">rpc</span><span class="o">.</span><span class="nf">fetchAccessToken</span><span class="p">(</span><span class="nv">code</span><span class="p">:</span> <span class="n">authorization</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>

        <span class="c1">// Authenticate to Discord RPC API using the access token</span>
        <span class="k">let</span> <span class="nv">authentication</span> <span class="o">=</span> <span class="k">try</span> <span class="n">rpc</span><span class="o">.</span><span class="nf">authenticate</span><span class="p">(</span><span class="nv">accessToken</span><span class="p">:</span> <span class="n">accessToken</span><span class="o">.</span><span class="n">accessToken</span><span class="p">)</span>

        <span class="nf">print</span><span class="p">(</span><span class="s">"Hello </span><span class="se">\(</span><span class="n">authentication</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="se">)</span><span class="s">! o/"</span><span class="p">)</span>

        <span class="c1">// Receive an event when the local user select a voice channel</span>
        <span class="n">_</span> <span class="o">=</span> <span class="k">try</span> <span class="n">rpc</span><span class="o">.</span><span class="nf">subscribe</span><span class="p">(</span><span class="nv">event</span><span class="p">:</span> <span class="o">.</span><span class="n">voiceChannelSelect</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
        <span class="n">rpc</span><span class="o">.</span><span class="nf">disconnect</span><span class="p">()</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Error occured: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="nf">exit</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// This handler is called when a disconnection with the Discord RPC socket occurs</span>
<span class="n">discordRPC</span><span class="o">.</span><span class="n">onDisconnect</span> <span class="p">{</span> <span class="n">rpc</span><span class="p">,</span> <span class="n">eventClose</span> <span class="k">in</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Disconnection occurred: [</span><span class="se">\(</span><span class="n">eventClose</span><span class="o">.</span><span class="n">code</span><span class="se">)</span><span class="s">] </span><span class="se">\(</span><span class="n">eventClose</span><span class="o">.</span><span class="n">message</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// This handler is called when a response to an async command is received</span>
<span class="n">discordRPC</span><span class="o">.</span><span class="n">onResponse</span> <span class="p">{</span> <span class="n">rpc</span><span class="p">,</span> <span class="n">nonce</span><span class="p">,</span> <span class="n">commandType</span><span class="p">,</span> <span class="n">response</span> <span class="k">in</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Response received for command </span><span class="se">\(</span><span class="n">commandType</span><span class="se">)</span><span class="s"> with nonce: </span><span class="se">\(</span><span class="n">nonce</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// This handler is called when an error for an async command occurs</span>
<span class="n">discordRPC</span><span class="o">.</span><span class="n">onError</span> <span class="p">{</span> <span class="n">rpc</span><span class="p">,</span> <span class="n">nonce</span><span class="p">,</span> <span class="n">eventError</span> <span class="k">in</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Error occured on command </span><span class="se">\(</span><span class="n">eventError</span><span class="o">.</span><span class="n">cmd</span><span class="se">)</span><span class="s">: [</span><span class="se">\(</span><span class="n">eventError</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">code</span><span class="se">)</span><span class="s">] </span><span class="se">\(</span><span class="n">eventError</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">message</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// This handler is called when an update to a subscribed event is received</span>
<span class="n">discordRPC</span><span class="o">.</span><span class="n">onEvent</span> <span class="p">{</span> <span class="n">rpc</span><span class="p">,</span> <span class="n">eventType</span><span class="p">,</span> <span class="n">event</span> <span class="k">in</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Event received of type </span><span class="se">\(</span><span class="n">eventType</span><span class="se">)</span><span class="s">)"</span><span class="p">)</span>

    <span class="c1">// Cast raw event (Data) to SelectVoiceChannelEvent</span>
    <span class="k">if</span> <span class="n">eventType</span> <span class="o">==</span> <span class="o">.</span><span class="n">voiceChannelSelect</span> <span class="p">{</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">eventSVC</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">EventVoiceChannelSelect</span><span class="o">.</span><span class="nf">from</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="n">event</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">channelID</span> <span class="o">=</span> <span class="n">eventSVC</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">channelID</span> <span class="p">{</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"Voice channel </span><span class="se">\(</span><span class="n">channelID</span><span class="se">)</span><span class="s"> selected!"</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"Voice channel deselected!"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Init connection</span>
<span class="k">do</span> <span class="p">{</span>
    <span class="k">try</span> <span class="n">discordRPC</span><span class="o">.</span><span class="nf">connect</span><span class="p">()</span>
    <span class="nf">dispatchMain</span><span class="p">()</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"An error occured during connection init: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">}</span>

</code></pre>
<h4 id='avatar-image' class='heading'>Avatar image</h4>

<p>You can fetch a user avatar on Discord servers using this helper:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">authentication</span> <span class="o">=</span> <span class="k">try</span> <span class="n">rpc</span><span class="o">.</span><span class="nf">authenticate</span><span class="p">(</span><span class="nv">accessToken</span><span class="p">:</span> <span class="n">accessToken</span><span class="o">.</span><span class="n">accessToken</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">user</span> <span class="o">=</span> <span class="n">authentication</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">user</span>

<span class="k">let</span> <span class="nv">avatar</span><span class="p">:</span> <span class="kt">NSImage</span> <span class="o">=</span> <span class="k">try</span> <span class="n">user</span><span class="o">.</span><span class="nf">fetchAvatarImage</span><span class="p">()</span>
</code></pre>

<p>Or this one:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">authentication</span> <span class="o">=</span> <span class="k">try</span> <span class="n">rpc</span><span class="o">.</span><span class="nf">authenticate</span><span class="p">(</span><span class="nv">accessToken</span><span class="p">:</span> <span class="n">accessToken</span><span class="o">.</span><span class="n">accessToken</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">user</span> <span class="o">=</span> <span class="n">authentication</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">user</span>

<span class="k">let</span> <span class="nv">avatar</span><span class="p">:</span> <span class="kt">NSImage</span> <span class="o">=</span> <span class="k">try</span> <span class="nf">fetchUserAvatarImage</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="nv">avatar</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">avatar</span><span class="p">)</span>
</code></pre>
<h4 id='reusing-access-token' class='heading'>Reusing access token</h4>

<p>To avoid asking authorization to user on each run, you can persist the access
token (e.g. by using UserDefaults) and pass it directly to <code>authenticate(accessToken:)</code>.</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">persistentAuthentication</span><span class="p">(</span><span class="nv">rpc</span><span class="p">:</span> <span class="kt">DiscordRPC</span><span class="p">)</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="kt">ResponseAuthenticate</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">defaults</span> <span class="o">=</span> <span class="kt">UserDefaults</span><span class="o">.</span><span class="n">standard</span>
    <span class="k">let</span> <span class="nv">now</span> <span class="o">=</span> <span class="kt">Date</span><span class="p">()</span>

    <span class="c1">// If a previous token exists in UserDefaults and is still valid, use it</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">tokenValidity</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="nf">object</span><span class="p">(</span><span class="nv">forKey</span><span class="p">:</span> <span class="s">"tokenValidity"</span><span class="p">)</span> <span class="k">as?</span> <span class="kt">Date</span><span class="p">,</span>
        <span class="n">tokenValidity</span> <span class="o">&gt;</span> <span class="n">now</span> <span class="p">{</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">accessTokenData</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">forKey</span><span class="p">:</span> <span class="s">"token"</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">do</span> <span class="p">{</span>
                <span class="k">let</span> <span class="nv">accessToken</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">AccessToken</span><span class="o">.</span><span class="nf">from</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="n">accessTokenData</span><span class="p">)</span>
                <span class="k">return</span> <span class="k">try</span> <span class="n">rpc</span><span class="o">.</span><span class="nf">authenticate</span><span class="p">(</span><span class="nv">accessToken</span><span class="p">:</span> <span class="n">accessToken</span><span class="o">.</span><span class="n">accessToken</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span> <span class="cm">/* ignore */</span> <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Else request a new token</span>
    <span class="k">let</span> <span class="nv">authorization</span> <span class="o">=</span> <span class="k">try</span> <span class="n">rpc</span><span class="o">.</span><span class="nf">authorize</span><span class="p">(</span><span class="nv">oAuth2Scopes</span><span class="p">:</span> <span class="p">[</span><span class="o">.</span><span class="n">rpc</span><span class="p">])</span>
    <span class="k">let</span> <span class="nv">accessToken</span> <span class="o">=</span> <span class="k">try</span> <span class="n">rpc</span><span class="o">.</span><span class="nf">fetchAccessToken</span><span class="p">(</span><span class="nv">code</span><span class="p">:</span> <span class="n">authorization</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>
    <span class="k">let</span> <span class="nv">authentication</span> <span class="o">=</span> <span class="k">try</span> <span class="n">rpc</span><span class="o">.</span><span class="nf">authenticate</span><span class="p">(</span><span class="nv">accessToken</span><span class="p">:</span> <span class="n">accessToken</span><span class="o">.</span><span class="n">accessToken</span><span class="p">)</span>

    <span class="c1">// Then save it in UserDefaults for the next call</span>
    <span class="n">defaults</span><span class="o">.</span><span class="nf">set</span><span class="p">(</span><span class="n">authentication</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">expires</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="s">"tokenValidity"</span><span class="p">)</span>
    <span class="n">defaults</span><span class="o">.</span><span class="nf">set</span><span class="p">(</span><span class="k">try</span> <span class="nf">newJSONEncoder</span><span class="p">()</span><span class="o">.</span><span class="nf">encode</span><span class="p">(</span><span class="n">accessToken</span><span class="p">),</span> <span class="nv">forKey</span><span class="p">:</span> <span class="s">"token"</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">authentication</span>
<span class="p">}</span>
</code></pre>
<h3 id='documentation' class='heading'>Documentation</h3>

<p>Generated using <a href="https://github.com/realm/jazzy">Jazzy</a> and hosted on <a href="https://aeddi.github.io/DiscordRPC">GitHub Pages</a>.</p>
<h2 id='changelog' class='heading'>Changelog</h2>

<p>See <a href="https://github.com/aeddi/DiscordRPC/blob/master/CHANGELOG.md">Changelog.md</a>.</p>
<h2 id='credits' class='heading'>Credits</h2>

<p>Thanks to <a href="https://github.com/Azoy">@Azoy</a> for his <a href="https://github.com/Azoy/SwordRPC">SwordRPC</a>
repo from which I basically copied the IPC communication part.</p>

          </section>
        </section>
        <section id="footer">
          <p>© 2021 <a class="link" href="https://github.com/aeddi" target="_blank" rel="external">Antoine Eddi</a> under <a class="link" href="https://github.com/aeddi/DiscordRPC/blob/master/LICENSE" target="_blank" rel="external">MIT License</a></p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.13.7</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
